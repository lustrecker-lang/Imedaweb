/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes rapid prototyping by focusing on authorization and skipping data validation.
 * It enforces access control based on user authentication.
 *
 * Data Structure:
 * - /pages/{pageId}: Stores content for specific pages.  Authenticated users can create, read, update, and delete page content.
 * - /companyProfile/{profileId}: Stores company profile information. Authenticated users can create, read, update, and delete company profiles.
 *
 * Key Security Decisions:
 * - Authenticated users can list all pages and company profiles.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the 'pages' collection.
     * @path /pages/{pageId}
     * @allow (list) Authenticated user listing all pages.
     * @deny (list) Unauthenticated user listing all pages.
     * @allow (create) Authenticated user creating a page.
     * @deny (create) Unauthenticated user creating a page.
     * @allow (update) Authenticated user updating a page.
     * @deny (update) Unauthenticated user updating a page if the document does not exist.
     * @allow (delete) Authenticated user deleting a page.
     * @deny (delete) Unauthenticated user deleting a page.
     * @principle Authenticated users can manage (create, read, update, delete) page content.
     */
    match /pages/{pageId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Controls access to the 'companyProfile' collection.
     * @path /companyProfile/{profileId}
     * @allow (list) Authenticated user listing all profiles.
     * @deny (list) Unauthenticated user listing all profiles.
     * @allow (create) Authenticated user creating a company profile.
     * @deny (create) Unauthenticated user creating a company profile.
     * @allow (update) Authenticated user updating a company profile.
     * @deny (update) Unauthenticated user updating a company profile if the document does not exist.
     * @allow (delete) Authenticated user deleting a company profile.
     * @deny (delete) Unauthenticated user deleting a company profile.
     * @principle Authenticated users can manage (create, read, update, delete) company profiles.
     */
    match /companyProfile/{profileId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    // Helper function to check if a user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }
  }
}