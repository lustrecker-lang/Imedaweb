/**
 * @file Firestore Security Rules
 * @description This ruleset prioritizes a flexible data structure for prototyping while enforcing authentication for content editing.
 *
 * Core Philosophy:
 *   - Allows public read access to all content, enabling a publicly accessible website.
 *   - Restricts write access to authenticated users. This is a basic level of protection.
 *
 * Data Structure:
 *   - Content is organized into two top-level collections: `/pages/{pageId}` and `/companyProfile/{profileId}`.
 *   - The rules do NOT enforce the schema of the documents, allowing for flexible data shapes during prototyping.
 *
 * Key Security Decisions:
 *   - Public Read Access: All `get` and `list` operations are allowed for all users (including unauthenticated users).
 *   - Authenticated Writes: Only authenticated users can `create`, `update`, or `delete` documents. No ownership checks are performed. This is a trade-off to simplify the rules for initial prototyping. Consider adding ownership checks once the data model stabilizes.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to page content, but restricts write access to authenticated users.
     * @path /pages/{pageId}
     * @allow (get, list) Allow anyone to read page content.
     * @deny (create, update, delete) Deny unauthenticated users from modifying page content.
     * @principle Allows public read access with authenticated writes.
     */
    match /pages/{pageId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows public read access to company profile, but restricts write access to authenticated users.
     * @path /companyProfile/{profileId}
     * @allow (get, list) Allow anyone to read company profile.
     * @deny (create, update, delete) Deny unauthenticated users from modifying company profile.
     * @principle Allows public read access with authenticated writes.
     */
    match /companyProfile/{profileId} {
      allow get, list: if true;
      allow create, update, delete: if isSignedIn();
    }

    // --- Helper Functions ---

    /**
     * @description Checks if the user is signed in.
     * @return {bool} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}