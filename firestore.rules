/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes security by default, restricting access unless explicitly allowed.
 * It focuses on secure authorization patterns (e.g., ownership, roles) and validates relationships.
 * Data validation is minimized to enable rapid prototyping, but crucial authorization fields are strictly validated.
 *
 * Data Structure:
 * - /companyProfile/{profileId}: Stores company branding information. Intended to be read publicly.
 * - /pages/{pageId}: Stores content for specific pages, editable by authenticated users.
 *
 * Key Security Decisions:
 * - Public read access to /companyProfile/{profileId}.
 * - Authenticated users can create, update, and delete pages under /pages/{pageId}.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to company profile information. Authenticated users can create, update, and delete.
     * @path /companyProfile/{profileId}
     * @allow (get, list) Accessing company profile data is open to everyone.
     * @allow (create) Authenticated user can create a profile.
     * @allow (update, delete) Authenticated user can update/delete a profile.
     * @deny (create, update, delete) Unauthenticated users cannot create, update or delete company profile.
     * @principle Allows public read access while requiring authentication for write operations.
     */
    match /companyProfile/{profileId} {
      allow get: if true;
      allow list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Manages content for specific pages, accessible to authenticated users.
     * @path /pages/{pageId}
     * @allow (get, list) Authenticated user can retrieve/list pages.
     * @allow (create) Authenticated user can create a page.
     * @allow (update, delete) Authenticated user can update/delete a page.
     * @deny (create, update, delete) Unauthenticated users cannot create, update, or delete pages.
     * @principle Enforces authentication for all write operations on pages.
     */
    match /pages/{pageId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }
  }

  // Helper function to determine if a user is signed in.
  function isSignedIn() {
    return request.auth != null;
  }
}