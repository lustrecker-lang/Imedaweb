/**
 * @file Firestore Security Rules
 * @description This ruleset allows public read access to all data while restricting write access to authenticated users only.
 *
 * Core Philosophy:
 * This ruleset adopts a public-read, authenticated-write model. All data is freely readable, but any modification requires a valid user authentication.
 *
 * Data Structure:
 * - /pages/{pageId}: Stores content for individual pages.
 * - /companyProfile/{profileId}: Stores company branding information.
 *
 * Key Security Decisions:
 * - Public Read Access: All `get` and `list` operations are allowed for all users.
 * - Authenticated Writes: `create`, `update`, and `delete` operations are restricted to authenticated users.
 * - No Data Validation: In this prototyping phase, data validation is minimal, focusing only on authentication.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to page content, but restricts writes to authenticated users.
     * @path /pages/{pageId}
     * @allow (get, list)
     * @allow (create) - User with valid authentication creates a new page.
     * @allow (update) - User with valid authentication updates an existing page.
     * @allow (delete) - User with valid authentication deletes a page.
     * @deny (create) - Unauthenticated user attempts to create a page.
     * @deny (update) - Unauthenticated user attempts to update a page.
     * @deny (delete) - Unauthenticated user attempts to delete a page.
     * @principle Public read, authenticated write.
     */
    match /pages/{pageId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Allows public read access to company profile information, but restricts writes to authenticated users.
     * @path /companyProfile/{profileId}
     * @allow (get, list)
     * @allow (create) - User with valid authentication creates a company profile.
     * @allow (update) - User with valid authentication updates an existing company profile.
     * @allow (delete) - User with valid authentication deletes a company profile.
     * @deny (create) - Unauthenticated user attempts to create a company profile.
     * @deny (update) - Unauthenticated user attempts to update a company profile.
     * @deny (delete) - Unauthenticated user attempts to delete a company profile.
     * @principle Public read, authenticated write.
     */
    match /companyProfile/{profileId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    // Helper function to check if the user is signed in.
    function isSignedIn() {
      return request.auth != null;
    }
  }
}