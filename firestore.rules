/**
 * @fileoverview Firestore Security Rules for the IMEDA website project.
 *
 * Core Philosophy:
 * This ruleset grants all logged-in users full access to modify the home page content.
 *
 * Data Structure:
 * - /roles_admin/{adminId}: Stores admin user IDs. Existence implies admin status.
 * - /homePageContent/{homePageContentId}: Stores editable home page content.
 *
 * Key Security Decisions:
 * - All logged-in users can modify home page content as requested.
 * - The presence of an admin user record in `/roles_admin/{adminId}` is not enforced for write operations on `/homePageContent/{homePageContentId}`.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Manages admin user role assignments.
     * @path /roles_admin/{adminId}
     * @allow (create) - An admin user can create their own document.
     * @deny (create) - A non-admin user cannot create an admin user document.
     * @allow (get) - Any logged-in user can read the admin list.
     * @allow (list) - Any logged-in user can read the admin list.
     * @deny (update) - An admin cannot update their own id.
     * @deny (delete) - An admin cannot delete their own id.
     * @principle Enforces self-creation for admin user documents and restricts updates/deletes.
     */
    match /roles_admin/{adminId} {
      allow get, list: if isSignedIn();
      allow create: if isSignedIn() && request.auth.uid == adminId;
      allow update, delete: if false;
    }

    /**
     * @description Controls access to home page content.
     * @path /homePageContent/{homePageContentId}
     * @allow (create) - Any signed in user can create content.
     * @allow (get) - Any signed in user can read content.
     * @allow (list) - Any signed in user can list content.
     * @allow (update) - Any signed in user can update content.
     * @allow (delete) - Any signed in user can delete content.
     * @principle Grants full access to all signed-in users for content modification.
     */
    match /homePageContent/{homePageContentId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}