/**
 * @fileoverview Firestore Security Rules for Prototyping.
 *
 * Core Philosophy:
 * This ruleset prioritizes security by enforcing strict access control based on
 * user authentication while allowing flexible data shapes for rapid prototyping.
 * It explicitly denies potentially unsafe operations like listing all users.
 *
 * Data Structure:
 * - /pages/{pageId}: Stores content for individual pages. Accessible to authenticated users.
 * - /companyProfile/{profileId}: Stores company branding information. Accessible to authenticated users.
 *
 * Key Security Decisions:
 * - Listing all documents in the `pages` and `companyProfile` collections is allowed.
 * - Only authenticated users can create, update, and delete documents.
 * - No data validation is performed beyond authentication checks. This allows for flexibility during prototyping.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to page content.
     * @path /pages/{pageId}
     * @allow (get, list) if true - Allows anyone to read page content.
     * @allow (create, update, delete) if isSignedIn() - Allows only authenticated users to modify page content.
     * @deny (create, update, delete) if !isSignedIn() - Denies unauthenticated users from modifying page content.
     * @principle Authenticated users can create, update, and delete page content.
     */
    match /pages/{pageId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Controls access to company profile information.
     * @path /companyProfile/{profileId}
     * @allow (get, list) if true - Allows anyone to read company profile information.
     * @allow (create, update, delete) if isSignedIn() - Allows only authenticated users to modify company profile information.
     * @deny (create, update, delete) if !isSignedIn() - Denies unauthenticated users from modifying company profile information.
     * @principle Authenticated users can create, update, and delete company profile information.
     */
    match /companyProfile/{profileId} {
      allow get, list: if true;
      allow create: if isSignedIn();
      allow update: if isSignedIn() && resource != null;
      allow delete: if isSignedIn() && resource != null;
    }

    /**
     * @description Denies access to the /leads collection, requiring server-side access via Cloud Functions.
     * @path /leads/{leadId}
     * @allow read, write: if false; - Explicitly denies all reads and writes to this collection.
     * @principle Prevents direct client access to potentially sensitive lead data, enforcing access through secure server-side functions.
     */
    match /leads/{leadId} {
        allow read, write: if false;
    }
  }
}

/**
 * @description Checks if the user is signed in.
 * @return {boolean} True if the user is signed in, false otherwise.
 */
function isSignedIn() {
  return request.auth != null;
}