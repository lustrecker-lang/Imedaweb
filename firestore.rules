/**
 * @file Firestore Security Rules
 * @core_philosophy This ruleset implements a flexible content management system with authenticated user access.
 *   It provides read and write access to authenticated users. Data shapes are not strictly enforced to allow for rapid prototyping.
 * @data_structure
 *   - /pages/{pageId}: Stores content for specific pages. Accessible to authenticated users.
 *   - /companyProfile/{profileId}: Stores company branding information. Accessible to authenticated users.
 * @key_security_decisions
 *   - Authenticated users can read and write page content.
 *   - Authenticated users can read and write company profile data.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls read and write access to page content.
     * @path /pages/{pageId}
     * @allow (get) Authenticated user can read a page: auth != null
     * @allow (list) Authenticated user can list pages: auth != null
     * @allow (create) Authenticated user can create a page: auth != null
     * @allow (update) Authenticated user can update a page: auth != null
     * @allow (delete) Authenticated user can delete a page: auth != null
     * @deny (get) Unauthenticated user cannot read a page: auth == null
     * @deny (list) Unauthenticated user cannot list pages: auth == null
     * @deny (create) Unauthenticated user cannot create a page: auth == null
     * @deny (update) Unauthenticated user cannot update a page: auth == null
     * @deny (delete) Unauthenticated user cannot delete a page: auth == null
     * @principle Allows authenticated users full access to page content, prototyping mode allows flexible data shapes.
     */
    match /pages/{pageId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Controls read and write access to company profile information.
     * @path /companyProfile/{profileId}
     * @allow (get) Authenticated user can read a profile: auth != null
     * @allow (list) Authenticated user can list profiles: auth != null
     * @allow (create) Authenticated user can create a profile: auth != null
     * @allow (update) Authenticated user can update a profile: auth != null
     * @allow (delete) Authenticated user can delete a profile: auth != null
     * @deny (get) Unauthenticated user cannot read a profile: auth == null
     * @deny (list) Unauthenticated user cannot list profiles: auth == null
     * @deny (create) Unauthenticated user cannot create a profile: auth == null
     * @deny (update) Unauthenticated user cannot update a profile: auth == null
     * @deny (delete) Unauthenticated user cannot delete a profile: auth == null
     * @principle Allows authenticated users full access to company profile, prototyping mode allows flexible data shapes.
     */
    match /companyProfile/{profileId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

      /**
       * @description Leads are currently not accessible to anyone. Access will be configured later.
       * @path /leads
       * @allow (get) no one can get leads: if false;
       * @allow (list) no one can list leads: if false;
       * @allow (create) no one can create leads: if false;
       * @allow (update) no one can update leads: if false;
       * @allow (delete) no one can delete leads: if false;
       * @principle Denies all access to leads until specific access rules are implemented.
       */
      match /leads/{leadId} {
        allow get: if false;
        allow list: if false;
        allow create: if false;
        allow update: if false;
        allow delete: if false;
      }

  }

  function isSignedIn() {
    return request.auth != null;
  }
}